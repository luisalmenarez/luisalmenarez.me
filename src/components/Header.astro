---
import LanguageSwitcher from '@/components/LanguageSwitcher.astro';
import ThemeToggle from '@/components/ThemeToggle.astro';
import { useTranslations, defaultLocale } from '@/i18n';
import type { Locale } from '@/i18n';

interface Props {
  lang: Locale;
}

const { lang } = Astro.props;
const t = useTranslations(lang);
const prefix = lang === defaultLocale ? '' : `/${lang}`;

const navItems = [
  {
    title: t('nav.experience'),
    label: 'experiencia',
    url: `${prefix}/#experiencia`,
  },
  {
    title: t('nav.projects'),
    label: 'proyectos',
    url: `${prefix}/#proyectos`,
  },
  {
    title: t('nav.about'),
    label: 'sobre-mi',
    url: `${prefix}/#sobre-mi`,
  },
  {
    title: t('nav.contact'),
    label: 'contacto',
    url: 'mailto:luisalmenarez0428@gmail.com',
    mobileHidden: true,
  },
];

const navItemsMobile = navItems.filter((item) => !item.mobileHidden);
---

<header
  id="main-header"
  class="fixed top-0 z-50 w-full"
>
  <nav
    class="flex md:grid md:grid-cols-[1fr_auto_1fr] items-center gap-2 max-w-7xl mx-auto px-3 md:px-4 py-2 md:py-3"
  >
    <div class="hidden md:block" aria-hidden="true"></div>

    <div
      class="nav-blur min-w-0 flex flex-initial md:hidden items-center justify-start gap-x-0.5 text-xs font-medium text-gray-600 dark:text-gray-300 rounded-full px-1.5 py-1 border transition-colors duration-300 bg-transparent border-transparent"
    >
      {
        navItemsMobile.map(
          (link: { title: string; label: string; url: string }) => (
            <a
              class="relative block px-1.5 py-1 transition-colors rounded-full hover:text-indigo-500 dark:hover:text-indigo-400 whitespace-nowrap"
              aria-label={link.label}
              href={link.url}
            >
              {link.title}
            </a>
          ),
        )
      }
    </div>

    <div
      class="nav-blur min-w-0 hidden md:flex md:flex-initial items-center justify-center gap-x-1 text-sm font-medium text-gray-600 dark:text-gray-300 rounded-full px-2 py-1.5 border transition-colors duration-300 bg-transparent border-transparent"
    >
      {
        navItems.map((link: { title: string; label: string; url: string }) => (
          <a
            class="relative block px-3 py-1 transition-colors rounded-full hover:text-indigo-500 dark:hover:text-indigo-400 whitespace-nowrap"
            aria-label={link.label}
            href={link.url}
          >
            {link.title}
          </a>
        ))
      }
    </div>

    <div
      class="flex flex-shrink-0 items-center xl:justify-end gap-x-0.5 md:gap-x-1 text-xs md:text-sm font-medium text-gray-600 dark:text-gray-300"
    >
      <LanguageSwitcher />
      <ThemeToggle />
    </div>
  </nav>
</header>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const navBlurs = document.querySelectorAll('.nav-blur');
    const scrolledClasses = ['bg-white/70', 'dark:bg-gray-900/70', 'backdrop-blur-lg', 'border-gray-300/50', 'dark:border-gray-700/30', 'shadow-sm'];
    const defaultClasses = ['bg-transparent', 'border-transparent'];

    function updateNav() {
      const scrolled = window.scrollY > 20;
      navBlurs.forEach((el) => {
        if (scrolled) {
          el.classList.remove(...defaultClasses);
          el.classList.add(...scrolledClasses);
        } else {
          el.classList.remove(...scrolledClasses);
          el.classList.add(...defaultClasses);
        }
      });
    }

    window.addEventListener('scroll', updateNav, { passive: true });
    updateNav();
  });
</script>
