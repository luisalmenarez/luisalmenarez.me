---
import FolderIcon from '@/components/icons/FolderIcon.astro';
import ArrowOutward from '@/components/icons/ArrowOutward.astro';
import ArrowDown from '@/components/icons/ArrowDown.astro';
import GitHub from '@/components/icons/GitHub.astro';
import ExternalLink from '@/components/icons/ExternalLink.astro';
import { PROJECTS } from '@/data/projects';
import { useTranslations } from '@/i18n';
import type { Locale } from '@/i18n';

interface Props {
  lang: Locale;
}

const { lang } = Astro.props;
const t = useTranslations(lang);
const projects = PROJECTS[lang];
---

<div class="md:grid-cols-2 print:flex print:flex-col grid grid-cols-1 gap-6">
  {
    projects.map(({ title, description, tags, link, github, highlights }) => (
      <article
        class="bg-white dark:bg-zinc-900 border-zinc-200 dark:border-zinc-800 hover:border-zinc-400 dark:hover:border-zinc-700 relative flex flex-col p-6 transition-colors duration-200 border rounded-lg shadow-lg"
      >
        <div class="flex items-center justify-between mb-3">
          {link && (
            <a
              href={link}
              target="_blank"
              rel="noopener noreferrer"
              class="group/more text-indigo-600 dark:text-indigo-400 flex gap-2 p-1 rounded"
            >
              <FolderIcon class="size-5 text-zinc-500 dark:text-zinc-400" />

              <h3 class="text-base font-semibold leading-tight">{title}</h3>
              <span class="group-hover/more:translate-x-0.5 group-hover/more:-translate-y-0.5 duration-200 ease-out">
                <ArrowOutward class="size-5" />
              </span>
            </a>
          )}
        </div>
        <p class="text-zinc-700 dark:text-zinc-300 mb-4 text-sm">
          {description}
        </p>

        <details class="proj-details group/details mb-4">
          <summary
            class="group/more w-fit cursor-pointer items-center justify-center gap-1.5 text-xs underline text-zinc-500 dark:text-zinc-400 transition-colors duration-300 hover:text-black dark:hover:text-white flex list-none [&::-webkit-details-marker]:hidden"
          >
            <span class="proj-toggle-text text-zinc-500 dark:text-zinc-400 text-sm italic underline">
              {t('projects.showMore')}
            </span>
            <ArrowDown
              class="text-zinc-500 dark:text-zinc-400 size-4 transition-transform duration-300 group-open/details:rotate-180"
            />
          </summary>
          <div class="flex flex-col gap-4 mt-4 animate-fade-in">
            <h4 class="text-lg font-semibold">{t('projects.features')}</h4>
            <ul class="text-zinc-700 dark:text-zinc-300 space-y-2 text-sm">
              {highlights.map((highlight) => (
                <li class="flex items-start gap-2">
                  <div class="w-1.5 h-1.5 rounded-full bg-zinc-400 dark:bg-zinc-500 flex-shrink-0 mt-2" />
                  <span>{highlight}</span>
                </li>
              ))}
            </ul>
          </div>
        </details>

        <div class="flex flex-wrap gap-2 mb-4">
          {tags.map((tag) => (
            <span
              class={`inline-flex items-center gap-1.5 rounded-full text-xs py-1 px-2.5 ${tag.class}`}
            >
              <tag.icon class="size-3" />
              {tag.name}
            </span>
          ))}
        </div>
        <div class="border-zinc-200 dark:border-zinc-800 flex gap-6 pt-4 mt-auto border-t">
          {github && (
            <a
              href={github}
              target="_blank"
              rel="noopener noreferrer"
              class="text-zinc-500 dark:text-zinc-400 hover:text-black dark:hover:text-white inline-flex items-center gap-2 text-sm transition-colors"
            >
              <GitHub class="size-5" />
              {t('projects.viewGithub')}
            </a>
          )}
          {link && (
            <a
              href={link}
              target="_blank"
              rel="noopener noreferrer"
              class="text-zinc-500 dark:text-zinc-400 hover:text-black dark:hover:text-white inline-flex items-center gap-2 text-sm transition-colors"
            >
              <ExternalLink class="size-5" />
              {t('projects.visitSite')}
            </a>
          )}
        </div>
      </article>
    ))
  }
</div>

<script>
  document.querySelectorAll('.proj-details').forEach((details) => {
    const toggleText = details.querySelector('.proj-toggle-text');
    if (!toggleText) return;
    const showMore = toggleText.textContent?.trim() || '';
    const showLess = showMore === 'Mostrar mÃ¡s' ? 'Mostrar menos' : 'Show less';

    details.addEventListener('toggle', () => {
      toggleText.textContent = (details as HTMLDetailsElement).open ? showLess : showMore;
    });
  });
</script>
